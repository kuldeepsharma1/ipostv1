import { NextRequest } from "next/server";
import { ImageResponse } from "next/og";
import { siteConfig } from "../../../../config/site";

export const runtime = "edge";

const interBold = fetch(
  new URL("../../../../assets/fonts/Inter-Bold.ttf", import.meta.url)
).then((res) => res.arrayBuffer());

export async function GET(req: NextRequest) {
  try {
    const fontBold = await interBold;

    const { searchParams } = req.nextUrl;
    const title = searchParams.get("title");

    if (!title) {
      return new Response("No title provided", { status: 500 });
    }

    const heading =
      title.length > 140 ? `${title.substring(0, 140)}...` : title;

    return new ImageResponse(
      (
        <div tw="flex relative flex-col p-12 w-full h-full items-start text-black bg-white">
          <div tw="flex items-center">
             <svg version="1.1" viewBox="0 0 1600 1600" width="150" height="200" xmlns="http://www.w3.org/2000/svg">
              <path transform="translate(770,484)" d="m0 0c3.61 3.9 5.86 8.57 6.19 13.9-0.61 6.84-4.65 13.1-7.68 19.1-0.345 0.688-0.69 1.38-1.04 2.09-2.42 4.82-4.84 9.64-7.27 14.5-2.3 4.56-4.59 9.13-6.88 13.7-0.482 0.959-0.964 1.92-1.46 2.91-6.54 13-12.9 26.1-18.8 39.4-2.74 6.09-5.74 11.3-10 16.4-0.597 0.731-1.19 1.46-1.81 2.21-9.75 10.3-23.4 16.1-36.2 21.8-0.014 0.993-0.014 0.993-0.0283 2.01-0.386 22-2.49 43.2-9.97 64-0.435 1.29-0.868 2.58-1.3 3.86-5.33 15.4-13.2 29.9-22.7 43.1-0.51 0.745-1.02 1.49-1.55 2.26-7.77 11-17.4 16-30 20-1.23 0.402-1.23 0.402-2.49 0.812-2 0.651-4 1.3-6.01 1.94 0.637 5.95 0.637 5.95 1.42 11.9 0.506 3.64 0.838 6.35-0.359 9.86-5.3 5.78-12.2 9.72-19 13.6-0.832 0.474-1.66 0.949-2.52 1.44-1.7 0.967-3.41 1.93-5.12 2.89-1.51 0.848-3.02 1.7-4.52 2.56-16.4 9.36-34.1 16.7-52.2 22.1-1.18 0.364-1.18 0.364-2.38 0.736-4.38 1.3-8.61 2.16-13.2 2.73-5.8 0.86-11.3 1.7-16.2 5.22-4.53 6.52-5.78 14.6-7.26 22.3-0.735 3.68-1.62 7.29-2.57 10.9-9.97 38.4-14.3 77.3-17.2 117 48 8.1 97.6 6.36 146 0.562 0.864-0.103 1.73-0.206 2.62-0.313 21-1.51 21-1.51 38.6-11.2 2.32-4.64 1.61-10.9 0.211-15.7-1.39-3.5-2.94-6.79-4.82-10.1-1.64-3.76-1.89-7.04-1.83-11.1 0.0157-1.07 0.0157-1.07 0.0317-2.15 0.352-10.1 4.64-14.9 11.8-21.7 24.6-21.7 71.3-15.6 102-15.8 31.5-0.123 31.5-0.123 63.1-1.42 1.29-0.0787 2.58-0.157 3.9-0.238 21-1.42 43.5-3.42 60.7-16.8-0.33-0.33-0.66-0.66-1-1-1.69 0.0808-3.38 0.165-5.07 0.268-8.86 0.449-14.5-1.31-22.1-5.74-2.7-1.77-2.7-1.77-5.79-1.53-1.03 1.65-2.03 3.32-3 5h-2c2.37-9.1 5.16-18 8-27h2c-0.0464 1.09-0.0928 2.17-0.141 3.29-0.0375 1.45-0.0739 2.89-0.109 4.34-0.0503 1.07-0.0503 1.07-0.102 2.16-0.0955 5.2 0.862 8.12 4.35 12.2 1.92 1.47 1.92 1.47 4 2.31 0.66 0.306 1.32 0.611 2 0.926 7.97 3.03 14.4 2.03 22-1.24 2.18-9.62-1.96-17.4-6.36-25.8-0.637-2.17-0.637-2.17 0.0156-5.12 0.69-3.13 0.69-3.13-1.35-5.57-0.802-0.795-1.6-1.59-2.43-2.41-6.99-7.24-12.2-13.7-12.9-24.1 0.563-6.95 3.12-12.1 8-17 6.95-5.66 14.6-7.5 23.4-7.32 6.1 0.762 11.3 2.97 15.6 7.32 2.07 0.0675 2.07 0.0675 4-1 1.75-1.98 1.75-1.98 3-4 0.66 0.33 1.32 0.66 2 1-0.254 0.655-0.508 1.31-0.77 1.98-2.6 6.91-4.57 13.8-6.23 21h-2c-0.0258-0.797-0.0516-1.59-0.0781-2.41-0.344-6.43-0.64-10.7-4.92-15.6-0.454-0.578-0.908-1.16-1.38-1.75-5.05-3.89-11.5-3.99-17.6-3.25-4.55 1.3-7.88 3.25-10.5 7.25-2.29 4.83-2.35 9.08-0.758 14.1 3.19 7.35 9.92 16 17.3 19.7v2c0.597 0.253 1.19 0.505 1.81 0.766 2.46 1.39 3.6 2.71 5.25 4.98 0.486 0.655 0.972 1.31 1.47 1.98 3.7 5.73 5.04 10.5 5.65 17.1 0.0819 0.764 0.164 1.53 0.248 2.32 1.21 12 0.244 22.3-7.68 32-3.2 3.24-6.82 5.53-10.8 7.77-0.773 0.442-1.55 0.884-2.34 1.34-16.3 8.71-35.6 11.2-53.7 13.3-1.5 0.179-1.5 0.179-3.04 0.362-15.9 1.75-31.8 2.1-47.8 2.4-3.01 0.0561-6.03 0.116-9.04 0.177-7.48 0.151-15 0.295-22.4 0.439-6.35 0.123-12.7 0.248-19.1 0.377-2.94 0.0586-5.87 0.113-8.81 0.168-8.45 0.165-16.9 0.39-25.3 0.876-0.688 0.0393-1.38 0.0787-2.08 0.119-10.9 0.681-22.1 2.86-30.4 10.4-2.25 2.27-2.25 2.27-3 5 0.357 4.52 1.37 8.16 3.22 12.3 4.74 10.7 5.98 22.6 2.89 34-4.25 9.4-11.7 13.5-20.9 17.3-53.1 19.2-117 12.5-172 7.95-0.729-0.0597-1.46-0.119-2.21-0.181-24-1.99-24-1.99-28.7-6.32-3.35-10-0.689-23.5 0.188-34 0.0656-0.792 0.131-1.58 0.199-2.4 3.38-40.3 10.2-79.4 21.4-118 0.208-0.722 0.416-1.44 0.631-2.19 0.563-1.94 1.13-3.88 1.7-5.82 1.93-6.3 1.93-6.3 0.463-12.4-1.05-1.54-1.05-1.54-2.12-3.12-0.755-1.16-1.51-2.32-2.25-3.49-0.374-0.576-0.748-1.15-1.13-1.74-11.1-17.3-16-38.6-19.1-58.6-0.191-1.19-0.382-2.38-0.578-3.6-3.74-31.7 0.876-65.2 13.1-94.5 0.269-0.658 0.537-1.32 0.814-1.99 1.83-4.09 3.5-6.11 7.62-7.88 9.7-2.47 20-2.55 30-3 0.0146-0.572 0.0292-1.14 0.0442-1.73 0.803-28.4 5.02-56.9 26-78.3h2c0.358-0.86 0.358-0.86 0.723-1.74 2.62-4.65 7.27-7.83 11.3-11.3 1.24-1.07 1.24-1.07 2.51-2.16 25.6-21.6 55.4-37.6 86.5-49.8 0.742-0.293 1.48-0.587 2.25-0.889 23.3-9.13 47.1-15.6 71.8-20.1 0.882-0.169 1.76-0.337 2.67-0.511 49.3-9.33 49.3-9.33 61.3-1.49zm-156 50c-0.846 0.4-1.69 0.8-2.56 1.21-10.8 5.11-21 10.6-30.7 17.5-1.75 1.24-3.52 2.46-5.29 3.67-22.3 15.4-44.5 35.3-51.2 62.7-1.94 11.2-2.34 22.8-2.14 34.1 0.0156 1.07 0.0313 2.15 0.0474 3.25 0.038 2.11 0.0943 4.22 0.171 6.32 0.112 5.99-0.0402 9.72-4.3 14.1-2 0.621-2 0.621-4 0.438-1.04-0.0889-1.04-0.0889-2.1-0.18-0.94-0.128-0.94-0.128-1.9-0.258-0.784-0.0619-1.57-0.124-2.38-0.188-2.46-1.23-2.63-3.33-3.62-5.81-3.81-1.7-7.99-0.796-12-0.312-0.712 0.0664-1.42 0.133-2.16 0.201-3.23 0.383-5.52 0.88-8.19 2.78-16 22.5-15.1 65.2-11.3 90.8 0.309 1.76 0.309 1.76 0.625 3.55 0.309 1.76 0.309 1.76 0.625 3.55 2.6 13.3 6.92 25.5 13.4 37.4 0.99-0.33 1.98-0.66 3-1 1.35-2.74 2.51-5.42 3.62-8.25 0.71-1.74 1.42-3.48 2.13-5.22 0.368-0.909 0.735-1.82 1.11-2.75 5.19-12.8 10.6-25.3 17-37.6 1.29-2.49 2.55-4.98 3.82-7.47 9.45-18.5 19.5-36.7 31.3-53.7 1.11-1.64 2.22-3.29 3.32-4.93 11.9-17.7 24.4-34.8 38.1-51.2 1.38-1.66 2.75-3.34 4.1-5.03 4.21-5.27 8.59-10.2 13.4-14.9 1.65-1.6 3.2-3.25 4.75-4.95 2.56-2.27 3.83-3 7.25-3 2.82 1.24 4.51 2.36 6.38 4.81 0.89 3.12 0.498 5.07-0.375 8.19-3.44 5.77-7.93 10.3-12.6 15.1-0.568 0.598-1.14 1.2-1.72 1.81-0.519 0.538-1.04 1.08-1.57 1.63-1.34 1.38-1.34 1.38-1.13 3.42h-2c-1.37 1.47-1.37 1.47-2.81 3.5-2.86 3.79-5.8 7.48-8.82 11.1-5.65 6.86-11 13.8-16.1 21.1-2.11 3.01-4.27 5.97-6.46 8.93-3.1 4.26-6 8.6-8.79 13.1-1.55 2.48-3.12 4.93-4.71 7.38-10.6 16.4-19.8 33.5-28.4 51-0.929 1.88-1.88 3.74-2.84 5.6-8.66 16.9-16.1 34.3-22.1 52.3 3.4 1.15 5.52 0.836 8.94-0.152 0.967-0.278 1.93-0.555 2.93-0.841 1.03-0.311 2.07-0.623 3.13-0.944 1.07-0.319 2.14-0.638 3.25-0.967 10.2-3.11 20-6.83 29.8-11.1 0.787-0.343 1.57-0.685 2.38-1.04 20.7-8.82 20.7-8.82 38.6-22 0.0238-1.99 0.0238-1.99-0.375-4.12-0.309-1.92-0.309-1.92-0.625-3.88l-3.61 0.105c-1.57 0.0281-3.13 0.0554-4.7 0.082-1.18 0.0377-1.18 0.0377-2.38 0.0762-0.757 0.00967-1.51 0.0193-2.29 0.0293-0.696 0.0157-1.39 0.0314-2.11 0.0476-2.51-0.449-3.35-1.36-4.9-3.34-0.841-3.04-1.35-5.06-0.235-8.06 3.53-5.54 12-6.89 18-8.31 1.66-0.415 3.32-0.83 4.98-1.25 2.57-0.633 5.15-1.26 7.73-1.88 14.1-3.37 14.1-3.37 26.6-10.5 0.58-0.421 1.16-0.842 1.76-1.28 20.7-16.1 30.1-50.5 33.6-75.3 1.35-10.7 1.35-10.7 1.64-21.4-2.91-1.34-2.91-1.34-5.25 0-3.64 1.32-6.02 0.898-9.75 0-2.06-1.58-2.85-2.69-4-5-0.461-5.42-0.461-5.42 1.22-7.53 2.07-1.71 4.15-2.88 6.54-4.11 0.946-0.491 1.89-0.982 2.87-1.49 1.01-0.516 2.02-1.03 3.06-1.56 1.03-0.535 2.07-1.07 3.14-1.62 5.91-3.05 11.8-6.05 17.8-9.01 2.46-1.23 4.92-2.46 7.38-3.69 0.595-0.297 1.19-0.594 1.8-0.9 13.5-6.8 19.8-13 26-26.6 1.69-3.64 3.44-7.26 5.18-10.9 1.52-3.16 3.04-6.33 4.56-9.5 3.85-8.03 7.72-16 11.6-24.1 0.342-0.707 0.685-1.41 1.04-2.14 4.37-9.03 8.76-18 13.4-26.9 1.47-2.88 2.39-4.7 2.39-7.98-46.6-0.81-99.6 15-141 35z" />
              <path transform="translate(840 798)" d="m0 0c5.34 5.11 9.25 11.4 9.69 18.9 0.0503 0.839 0.101 1.68 0.152 2.54 0.57 17.3-5.57 34.5-17.2 47.5-0.643 0.746-1.29 1.49-1.95 2.26-7.81 8.48-18.4 14.4-30.1 15.1-1.43 0.0297-2.86 0.0423-4.29 0.0391-1.12-0.00242-1.12-0.00242-2.26-0.00488-5.84-0.13-10.4-1.13-15.4-4.37-0.928-0.598-1.86-1.2-2.81-1.81-6.41-6.41-9.33-15.2-9.5-24.1 0.536-17.7 8.04-35.1 20.2-48 13.7-12.9 37.2-21.1 53.5-7.91zm-44.3 8.88c-12.2 16.4-17.8 36.7-16 57 1.34 6.92 3.95 12.4 9.59 16.8 5.32 2.63 11.1 2.17 16.7 0.516 13-5.85 20.3-18.2 25.4-30.9 5.08-13.7 8.67-31.3 3.29-45.5-2.53-5.15-5.78-8.07-11-10.3-11.3-3.78-20.9 4.48-28 12.3z" />
              <path transform="translate(702,794)" d="m0 0c5.8-0.0747 11.6-0.129 17.4-0.165 1.97-0.015 3.94-0.0354 5.91-0.0615 2.84-0.0368 5.69-0.0535 8.53-0.0667 0.867-0.0155 1.73-0.031 2.63-0.0469 7.01-0.00189 14.3 0.861 20 5.24 0.525 0.672 1.05 1.34 1.59 2.04 0.548 0.669 1.1 1.34 1.66 2.03 2.87 4.57 2.85 9.79 2.28 15-2.34 9.11-7.95 16.7-15.8 21.8-11.3 6.01-22.7 7.26-35.2 8.16-1.88 5.51-3.65 11-5.19 16.6-0.344 1.23-0.688 2.46-1.04 3.73-0.772 3.66-0.909 6.92-0.77 10.6 2.64 0.66 5.28 1.32 8 2v1c-7.02 0.827-13.9 1.18-21 1.19-0.94 0.0122-1.88 0.0245-2.85 0.0371-1.34 0.0029-1.34 0.0029-2.71 0.00586-1.21 0.00616-1.21 0.00616-2.44 0.0125-2-0.243-2-0.243-4-2.24 0.603-0.0516 1.21-0.103 1.83-0.156 0.799-0.113 1.6-0.227 2.42-0.344 0.789-0.0928 1.58-0.186 2.39-0.281 4.45-2.3 5.67-7.08 7.15-11.6 0.81-2.82 1.55-5.66 2.27-8.51 0.595-2.29 1.19-4.57 1.79-6.86 0.332-1.28 0.663-2.55 1-3.87 1.31-4.99 2.68-9.97 4.04-15 0.761-2.79 1.52-5.57 2.28-8.36 0.504-1.85 1.01-3.69 1.52-5.53 0.721-2.62 1.43-5.23 2.14-7.85 0.218-0.783 0.437-1.57 0.662-2.37 1.13-4.2 1.74-7.87 1.5-12.3-2.64-0.99-5.28-1.98-8-3v-1zm21 6c-1.45 3.03-1.45 3.03-2.38 6.62-0.194 0.669-0.388 1.34-0.589 2.03-0.7 2.44-1.37 4.9-2.04 7.35-0.298 1.07-0.595 2.14-0.902 3.24-1.6 5.77-3.19 11.6-4.74 17.3-0.261 0.972-0.523 1.94-0.792 2.94-0.674 2.54-0.674 2.54-0.563 5.47 11 0.428 20.1 0.572 28.9-6.69 7.74-7.48 10.1-16.5 10.4-27-0.0938-4.47-0.691-7.57-3.31-11.3-4.02-3.76-8.07-4.17-13.4-4.31-0.927-0.0374-1.85-0.0748-2.81-0.113-3.68 0.569-5.18 1.75-7.75 4.43z" />
              <path transform="translate(1029,781)" d="m0 0c0.773 3.58 1.31 6.13 0.0625 9.62-4.44 5.11-9.99 8.06-16.7 8.58-0.985 0.0367-1.97 0.0733-2.98 0.111-1.07 0.0419-2.14 0.0838-3.24 0.127-1.11 0.0393-2.22 0.0786-3.37 0.119-1.13 0.0432-2.25 0.0864-3.41 0.131-2.78 0.106-5.56 0.208-8.34 0.307-3.04 10-5.87 20.1-8.47 30.3-1.39 5.44-2.83 10.9-4.34 16.3-0.859 3.09-1.71 6.18-2.55 9.28-0.422 1.53-0.85 3.06-1.28 4.59-0.611 2.16-1.2 4.32-1.79 6.48-0.349 1.25-0.699 2.5-1.06 3.79-0.545 3.6-0.305 5.2 1.5 8.32 1.92 1.02 1.92 1.02 4.12 1.31 1.28 0.227 2.56 0.454 3.88 0.688v1h-37c0.495-0.99 0.495-0.99 1-2 2.48-0.487 4.95-0.765 7.46-1.05 2.87-1.07 4.06-2.27 5.61-4.89 2.11-4.68 3.27-9.67 4.56-14.6 0.512-1.92 1.02-3.83 1.54-5.75 0.554-2.08 1.1-4.15 1.65-6.23 1.26-4.77 2.56-9.53 3.86-14.3 0.901-3.31 1.8-6.62 2.7-9.93 0.325-1.19 0.325-1.19 0.657-2.41 0.624-2.29 1.25-4.59 1.87-6.89 0.183-0.671 0.366-1.34 0.555-2.03 1.34-4.96 2.43-9.9 3.55-14.9-14.9-0.495-14.9-0.495-30-1 0.33-0.66 0.66-1.32 1-2 10.2-0.2 20.3-0.0967 30.5 1 13.1 1.4 26.3 1.19 39.5 1-0.16-1.36-0.16-1.36-0.324-2.74-0.12-1.18-0.24-2.36-0.363-3.57-0.128-1.17-0.255-2.34-0.387-3.55 0.0742-3.14 0.0742-3.14 1.32-5.07 2.91-1.77 5.56-0.725 8.75-0.0625z" />
              <path transform="translate(658,794)" d="m0 0h32v2c-0.603 0.0284-1.21 0.0567-1.83 0.0859-2.68 0.319-4.71 0.803-7.17 1.91-1.32 1.9-1.32 1.9-2.07 4.29-0.324 0.903-0.648 1.81-0.981 2.74-1.68 5.26-3.15 10.6-4.55 15.9-0.323 1.21-0.645 2.42-0.977 3.67-0.849 3.19-1.69 6.38-2.53 9.57-0.854 3.23-1.72 6.47-2.58 9.7-1.78 6.7-3.56 13.4-5.31 20.1-0.213 0.8-0.427 1.6-0.647 2.42-1.15 4.4-1.54 8.07-1.35 12.6 2.64 0.66 5.28 1.32 8 2v1h-33c3-2 3-2 6.44-2.5 3.54-1.08 3.54-1.08 4.64-3.26 3.05-8 5.12-16.2 7.18-24.5 0.782-3.11 1.57-6.22 2.36-9.34 0.197-0.783 0.395-1.57 0.598-2.37 1.34-5.29 2.73-10.6 4.16-15.8 0.187-0.69 0.374-1.38 0.567-2.09 0.886-3.27 1.78-6.53 2.68-9.79 0.315-1.16 0.63-2.32 0.954-3.51 0.278-1.01 0.556-2.02 0.842-3.05 0.574-2.68 0.706-5.03 0.592-7.77-2.64-0.66-5.28-1.32-8-2v-2z" />
              <path transform="translate(949,796)" d="m0 0c1.29 2.58 1.2 4.56 1.25 7.44 0.0387 1.45 0.0387 1.45 0.0781 2.93-0.328 2.63-0.328 2.63-1.69 4.45-1.64 1.18-1.64 1.18-4.14 1.62-2.5-0.438-2.5-0.438-4.38-2.06-1.55-3.28-1.18-4.93-0.125-8.38 4.13-6 4.13-6 9-6z" />
            </svg> 


            <p tw="ml-2 font-bold text-2xl">IPOST</p>
          </div>
          <div tw="flex flex-col flex-1 py-10">
            <div tw="flex text-xl uppercase font-bold tracking-tight font-normal">
              BLOG POST
            </div>
            <div tw="flex text-[80px] font-bold text-[50px]">{heading}</div>
          </div>
          <div tw="flex items-center w-full justify-between">
            <div tw="flex text-xl">{siteConfig.url}</div>
            <div tw="flex items-center text-xl">
              <div tw="flex ml-2">{siteConfig.links.github}</div>
            </div>
          </div>
        </div>
      ),
      {
        width: 1200,
        height: 630,
        fonts: [
          {
            name: "Inter",
            data: fontBold,
            style: "normal",
            weight: 700,
          },
        ],
      }
    );
  } catch (error) {
    return new Response("Failed to generate image", { status: 500 });
  }
}
